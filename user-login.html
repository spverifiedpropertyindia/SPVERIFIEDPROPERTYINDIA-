<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>User Login - SP Verified Property</title>

  <style>
    body{margin:0;font-family:Arial;background:#f6f7fb}
    header{background:#0b1b3a;color:#fff;padding:16px}
    .wrap{max-width:700px;margin:auto;padding:16px}
    .card{background:#fff;border-radius:16px;padding:16px;box-shadow:0 10px 24px rgba(0,0,0,.08)}
    .btn{width:100%;padding:12px;border:none;border-radius:12px;background:#ff7a00;color:#fff;font-weight:900}
    .mini{margin-top:10px;font-size:12px;color:#555}
  </style>
</head>
<body>
<header><b>User Login ✅</b></header>

<div class="wrap">
  <div class="card">
    <div class="mini" id="status">Loading...</div>
    <button class="btn" id="btn">Google Login ✅</button>
  </div>
</div>

<script type="module">
  // ✅ cache fix
  import { VPI } from "./vpi.js?v=2";

  const status = document.getElementById("status");
  const btn = document.getElementById("btn");

  function refresh(){
    const u = VPI.currentUser();

    if(!u){
      status.innerHTML="❌ Not logged in";
      return;
    }

    status.innerHTML = `✅ Logged in: <b>${u.email}</b><br/>Redirecting...`;
    setTimeout(()=>location.href="index.html", 400);
  }

  btn.onclick = async ()=>{
    try{
      status.innerHTML="⏳ Opening Google Login...";
      await VPI.googleLogin();
      status.innerHTML="⏳ Waiting for redirect...";
    }catch(e){
      console.log("LOGIN ERROR:", e);
      status.innerHTML = `❌ Login Error: <b>${e.message || e}</b>`;
    }
  };

  // ✅ keep checking
  setInterval(refresh, 800);
</script>
</body>
</html>