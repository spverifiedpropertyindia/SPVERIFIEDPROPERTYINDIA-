<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>

  <!-- ‚úÖ FORCE CORRECT DOMAIN -->
  <script>
    if (location.hostname === "pverifiedpropertyindia.github.io") {
      location.replace("https://spverifiedpropertyindia.github.io/SPVERIFIEDPROPERTYINDIA-/");
    }
  </script>

  <title>SP Verified Property - Dashboard</title>
  <style>
    body{margin:0;font-family:Arial;background:#f6f7fb}
    header{background:#0b1b3a;color:#fff;padding:16px}
    .wrap{max-width:900px;margin:auto;padding:16px}
    .card{background:#fff;border-radius:16px;padding:16px;box-shadow:0 10px 24px rgba(0,0,0,.08);margin-top:12px}
    a.btn{display:block;padding:12px;border-radius:12px;background:#0b1b3a;color:#fff;text-decoration:none;font-weight:900;margin-top:10px;text-align:center}
    .mini{font-size:12px;color:#666}
    .title{font-size:16px;font-weight:900;color:#0b1b3a;margin:0 0 6px}
    .box{background:#f1f3ff;border:1px solid #dfe3ff;padding:12px;border-radius:14px;margin-top:10px}
    ul{margin:8px 0 0 18px;padding:0}
    li{margin:6px 0}
    .supportBox{background:#fff7ed;border:1px solid #ffd8a8;padding:12px;border-radius:14px;margin-top:12px}
    .supportBtn{
      display:block;
      padding:12px;
      border-radius:12px;
      background:#ff7a00;
      color:#fff;
      text-decoration:none;
      font-weight:900;
      margin-top:10px;
      text-align:center;
    }
    .supportBtn2{
      display:block;
      padding:12px;
      border-radius:12px;
      background:#25D366;
      color:#fff;
      text-decoration:none;
      font-weight:900;
      margin-top:10px;
      text-align:center;
    }
    .supportBtn3{
      display:block;
      padding:12px;
      border-radius:12px;
      background:#0b1b3a;
      color:#fff;
      text-decoration:none;
      font-weight:900;
      margin-top:10px;
      text-align:center;
    }
  </style>
</head>
<body>
<header><b>Dashboard ‚úÖ</b></header>

<div class="wrap">

  <div class="card">
    <div class="mini" id="status">Loading...</div>
    <div class="mini" id="planReminder" style="margin-top:8px;font-weight:900;"></div>

    <a class="btn" href="user-setup.html">User Setup</a>
    <a class="btn" href="kyc.html">KYC Submit</a>
    <a class="btn" href="plans.html">Plans</a>
    <a class="btn" href="payment.html">Upload Payment Proof</a>
    <a class="btn" href="add-property.html">Add Property</a>
    <a class="btn" href="listings.html">Public Listings</a>
    <a class="btn" href="admin.html">Admin Panel</a>
    <a class="btn" href="contact.html">Support / Contact</a>

    <a class="btn" href="#" id="logoutBtn" style="background:#ff3b3b">Logout</a>
  </div>

  <div class="card">
    <p class="title">‚úÖ SP VERIFIED PROPERTY INDIA - Introduction</p>
    <div class="mini">
      SP VERIFIED PROPERTY INDIA ek <b>Property Listing + Verification Platform</b> hai jisme Owner / Seller / Broker
      apni property list kar sakte hai aur Buyer safely verified property dekh sakta hai.
    </div>

    <div class="box">
      <p class="title">‚úÖ Website Kaise Kaam Karta Hai? (Full Process)</p>
      <ul class="mini">
        <li><b>Step 1:</b> Google Login ‚úÖ</li>
        <li><b>Step 2:</b> User Setup fill ‡§ï‡§∞‡§®‡§æ compulsory ‚úÖ</li>
        <li><b>Step 3:</b> KYC Submit compulsory ‚úÖ</li>
        <li><b>Step 4:</b> Plan Select ‡§ï‡§∞‡§®‡§æ ‚úÖ</li>
        <li><b>Step 5:</b> Payment Proof Upload ‚úÖ</li>
        <li><b>Step 6:</b> Add Property ‚úÖ</li>
        <li><b>Step 7:</b> Admin Approval ‚úÖ</li>
      </ul>
    </div>

    <div class="box">
      <p class="title">‚úÖ KYC Ke Liye Kaunse Document Lagte Hai?</p>
      <ul class="mini">
        <li>Aadhaar Card (Front + Back)</li>
        <li>PAN Card</li>
        <li>Voter ID (Front + Back)</li>
        <li><b>Live Photo</b> camera se compulsory ‚úÖ</li>
      </ul>
    </div>

    <div class="box">
      <p class="title">‚úÖ Kya Kya Compulsory Hai?</p>
      <ul class="mini">
        <li>Google Login compulsory ‚úÖ</li>
        <li>User Setup compulsory ‚úÖ</li>
        <li>KYC Submit compulsory ‚úÖ</li>
        <li>Plan select + Payment proof ‚úÖ</li>
        <li>Property add me minimum 3 photos ‚úÖ</li>
        <li>GPS camera photo compulsory ‚úÖ</li>
        <li>Admin approval compulsory ‚úÖ</li>
      </ul>
    </div>
  </div>

  <div class="card">
    <p class="title">‚úÖ Support / Contact</p>
    <div class="supportBox">
      <div class="mini">
        üìû Mobile: <b>8305070599</b><br/>
        üìß Email: <b>spverifiedproperty@gmail.com</b><br/>
        üïô Working Time: <b>10 AM - 4 PM</b>
      </div>

      <a class="supportBtn2" href="https://wa.me/918305070599" target="_blank">WhatsApp Support ‚úÖ</a>
      <a class="supportBtn" href="tel:8305070599">Call Now ‚úÖ</a>
      <a class="supportBtn3" href="mailto:spverifiedproperty@gmail.com">Email Support ‚úÖ</a>
    </div>
  </div>

</div>

<script type="module">
  // ‚úÖ FINAL FIX: same version use karo everywhere
  import { VPI } from "./vpi.js?v=2";

  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";
  import { getApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";

  const db = getFirestore(getApp());

  const status = document.getElementById("status");
  const planReminder = document.getElementById("planReminder");
  const logoutBtn = document.getElementById("logoutBtn");

  async function refresh(){
    const u = VPI.currentUser();

    if(!u){
      status.innerHTML = `‚ùå Not logged in. <a href="user-login.html">Login</a>`;
      planReminder.innerHTML = "";
      return;
    }

    status.innerHTML = `‚úÖ Logged in: <b>${u.email}</b> ${VPI.isAdmin() ? "(ADMIN ‚úÖ)" : ""}`;

    try{
      planReminder.innerHTML = "";

      const snap = await getDoc(doc(db, "users", u.uid));
      if(!snap.exists()) return;

      const data = snap.data();
      const planStatus = data.planStatus || "";
      const planSelected = data.planSelected || "";
      const expiresAtObj = data.planExpiresAt;

      if(!planSelected){
        planReminder.innerHTML = "‚ÑπÔ∏è Plan: Not Selected";
        return;
      }

      if(planStatus !== "ACTIVE"){
        planReminder.innerHTML = `‚è≥ Plan: <b>${planSelected}</b> (Activation Pending)`;
        return;
      }

      if(!expiresAtObj){
        planReminder.innerHTML = `‚úÖ Plan Active: <b>${planSelected}</b>`;
        return;
      }

      const expiresAt = expiresAtObj.toDate ? expiresAtObj.toDate() : new Date(expiresAtObj);
      const now = new Date();

      const diffMs = expiresAt.getTime() - now.getTime();
      const daysLeft = Math.ceil(diffMs / (1000 * 60 * 60 * 24));

      if(daysLeft <= 0){
        planReminder.innerHTML = `‚ùå Plan Expired: <b>${planSelected}</b> | Renew Now ‚úÖ`;
      } else if(daysLeft <= 3){
        planReminder.innerHTML = `‚ö†Ô∏è Plan Expiring Soon: <b>${planSelected}</b> | ${daysLeft} day left ‚úÖ`;
      } else {
        planReminder.innerHTML = `‚úÖ Plan Active: <b>${planSelected}</b> |