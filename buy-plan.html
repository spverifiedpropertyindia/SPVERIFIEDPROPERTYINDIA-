window.payNowUPI = function(){
  updateAmount();

  const role = document.getElementById("role").value;
  const plan = document.getElementById("plan").value;
  const amount = PRICES[role][plan];

  // ✅ clear old QR box
  payBox.innerHTML = "";

  // ✅ BASIC (FREE) => No UPI Popup / No UPI App Open
  if(amount === 0){
    msg.innerHTML = "✅ BASIC (Free) plan selected. No payment needed. Submit to Activate.";
    return;
  }

  // ✅ Paid plans only
  const ok = confirm(`Pay ₹${amount} for ${role} - ${plan} Plan using UPI App?`);
  if(!ok){
    msg.innerHTML = "❌ Payment cancelled. You can use QR Backup button.";
    return;
  }

  const note = `${role}-${plan}-Plan`;
  const upiUrl = `upi://pay?pa=${UPI_ID}&pn=SP%20Verified%20Property%20India&am=${amount}&cu=INR&tn=${encodeURIComponent(note)}`;

  msg.innerHTML = "⏳ Opening UPI App (PhonePe/GPay/Paytm)...";

  setTimeout(()=>{
    payBox.innerHTML = `
      <div style="text-align:center;">
        <h3>✅ Payment Done?</h3>
        <p class="small">Agar aapne payment kar diya hai to UTR/Transaction ID niche डालें.</p>
        <button class="btn" style="width:100%;margin-top:10px;" onclick="paymentDoneFocus()">
          ✅ I Have Paid (Enter UTR)
        </button>
        <p class="small" style="margin-top:8px;color:#777;">
          Agar UPI app open nahi hua to नीचे "Generate QR & Pay (Backup)" use karein.
        </p>
      </div>
    `;
  }, 1200);

  // ✅ open UPI app
  window.location.href = upiUrl;
};
