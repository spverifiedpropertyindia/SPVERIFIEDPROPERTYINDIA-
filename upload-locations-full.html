<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Upload CG Full Locations</title>
</head>
<body style="font-family:Arial;padding:20px;">
  <h2>✅ Upload Chhattisgarh (District + Block + Village)</h2>

  <p><b>Step 1:</b> Upload District + Blocks (1 click)</p>
  <button id="uploadDistrictBlocksBtn" style="padding:12px 16px;font-size:16px;">
    ✅ Upload District + Blocks
  </button>

  <hr style="margin:18px 0;"/>

  <p><b>Step 2:</b> Upload Villages using JSON file (Chunk Mode)</p>
  <input type="file" id="villageJsonFile" accept=".json" />
  <button id="uploadVillagesBtn" style="padding:12px 16px;font-size:16px;">
    ✅ Upload Villages JSON (Chunk Upload)
  </button>

  <p id="status" style="margin-top:15px;color:green;"></p>

  <script type="module">
    import { db } from "./js/firebase.js";
    import { doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    const status = document.getElementById("status");

    // ✅ 33 Districts (Chhattisgarh)
    const CG_DISTRICTS = [
      "Balod","Baloda Bazar","Balrampur","Bastar","Bemetara","Bijapur",
      "Bilaspur","Dantewada","Dhamtari","Durg","Gariaband","Gaurela Pendra Marwahi",
      "Janjgir Champa","Jashpur","Kabirdham","Kanker","Kondagaon","Korba",
      "Koriya","Mahasamund","Manendragarh Chirmiri Bharatpur","Mohla Manpur Ambagarh Chowki",
      "Mungeli","Narayanpur","Raigarh","Raipur","Rajnandgaon","Sakti",
      "Sarangarh Bilaigarh","Sukma","Surajpur","Surguja","Khairagarh Chhuikhadan Gandai"
    ];

    // ✅ District -> Blocks (Best effort full)
    const BLOCKS_BY_DISTRICT = {
      "Raipur": ["Abhanpur","Arang","Tilda","Dharsiwa"],
      "Durg": ["Durg","Patan","Dhamdha"],
      "Bilaspur": ["Bilaspur","Masturi","Takhatpur","Bilha"],
      "Rajnandgaon": ["Rajnandgaon","Dongargaon","Dongargarh","Chhuikhadan","Mohla","Ambagarh Chowki","Manpur"],
      "Korba": ["Korba","Kartala","Katghora","Pali","Poundi-Uproda"],
      "Raigarh": ["Raigarh","Gharghoda","Kharsia","Lailunga","Pusour","Tamnar","Sarangarh"],
      "Janjgir Champa": ["Janjgir","Akaltara","Baloda","Bamhnidih","Dabhra","Jaijaipur","Pamgarh","Nawagarh","Sakti"],
      "Baloda Bazar": ["Baloda Bazar","Bhatapara","Bilaigarh","Kasdol","Palari","Simga"],
      "Mahasamund": ["Mahasamund","Bagbahara","Basna","Pithora","Saraipali"],
      "Dhamtari": ["Dhamtari","Kurud","Magarlod"],
      "Gariaband": ["Gariaband","Chhura","Deobhog","Mainpur"],
      "Kabirdham": ["Kawardha","Bodla","Pandariya","Sahaspur Lohara"],
      "Bemetara": ["Bemetara","Berla","Nawagarh","Saja"],
      "Balod": ["Balod","Gunderdehi","Dondi","Dondi Lohara","Gurur"],
      "Sakti": ["Sakti","Baradwar","Malkharoda","Dabhra","Jaijaipur","Nawagarh"],
      "Sarangarh Bilaigarh": ["Sarangarh","Bilaigarh","Baramkela"],
      "Khairagarh Chhuikhadan Gandai": ["Khairagarh","Chhuikhadan","Gandai"],
      "Mohla Manpur Ambagarh Chowki": ["Mohla","Manpur","Ambagarh Chowki"],
      "Mungeli": ["Mungeli","Lormi","Pathariya"],
      "Gaurela Pendra Marwahi": ["Gaurela","Pendra","Marwahi"],
      "Surguja": ["Ambikapur","Lundra","Sitapur","Udaipur","Batauli","Lakhanpur"],
      "Surajpur": ["Surajpur","Pratappur","Ramanujnagar","Bhaiyathan","Premnagar"],
      "Balrampur": ["Balrampur","Ramchandrapur","Wadrafnagar","Rajpur","Samri","Shankargarh"],
      "Jashpur": ["Jashpur","Kunkuri","Duldula","Pathalgaon","Bagicha","Manora"],
      "Koriya": ["Baikunthpur","Sonhat","Manendragarh","Bharatpur","Khongapani"],
      "Manendragarh Chirmiri Bharatpur": ["Manendragarh","Chirmiri","Bharatpur"],
      "Bastar": ["Jagdalpur","Bakawand","Bastar","Darbha","Tokapal","Lohandiguda"],
      "Kondagaon": ["Kondagaon","Makdi","Bade Rajpur","Keshkal","Farasgaon"],
      "Kanker": ["Kanker","Charama","Durgkondal","Bhanupratappur","Narharpur","Antagarh"],
      "Narayanpur": ["Narayanpur","Orchha"],
      "Dantewada": ["Dantewada","Katekalyan","Kuakonda"],
      "Bijapur": ["Bijapur","Bhairamgarh","Usoor","Bhopalpatnam"],
      "Sukma": ["Sukma","Chhindgarh","Kont"]
    };

    // ✅ Step 1 Upload
    document.getElementById("uploadDistrictBlocksBtn").onclick = async () => {
      status.innerHTML = "⏳ Uploading districts + blocks...";

      await setDoc(doc(db, "locations", "Chhattisgarh"), {
        state: "Chhattisgarh",
        districts: CG_DISTRICTS
      });

      for (const district of Object.keys(BLOCKS_BY_DISTRICT)) {
        await setDoc(doc(db, "blocks", district), {
          district,
          blocks: BLOCKS_BY_DISTRICT[district]
        });
      }

      status.innerHTML = "✅ District + Blocks uploaded successfully!";
      alert("✅ Done! District + Blocks uploaded.");
    };

    // ✅ Step 2 Upload Villages (Chunk Mode)
    document.getElementById("uploadVillagesBtn").onclick = async () => {
      const fileInput = document.getElementById("villageJsonFile");
      if (!fileInput.files[0]) {
        alert("❌ Please select villages JSON file!");
        return;
      }

      status.innerHTML = "⏳ Reading villages JSON file...";
      const text = await fileInput.files[0].text();
      const data = JSON.parse(text);

      status.innerHTML = "⏳ Uploading villages to Firestore (Chunk Mode)...";

      // ✅ split in chunks
      function chunkArray(arr, size = 500) {
        const out = [];
        for (let i = 0; i < arr.length; i += size) {
          out.push(arr.slice(i, i + size));
        }
        return out;
      }

      let totalDocs = 0;

      for (const districtName of Object.keys(data)) {
        const blocksObj = data[districtName] || {};

        for (const blockName of Object.keys(blocksObj)) {
          const villages = blocksObj[blockName] || [];

          const cleanDistrict = String(districtName).trim();
          const cleanBlock = String(blockName).trim();

          const chunks = chunkArray(villages, 500);

          for (let i = 0; i < chunks.length; i++) {
            const docId = `${cleanDistrict}_${cleanBlock}_${i + 1}`;

            await setDoc(doc(db, "villages", docId), {
              district: cleanDistrict,
              block: cleanBlock,
              part: i + 1,
              totalParts: chunks.length,
              villages: chunks[i]
            });

            totalDocs++;
          }
        }
      }

      status.innerHTML = `✅ Villages uploaded in chunks! Total docs: ${totalDocs}`;
      alert("✅ Villages upload completed (Chunk Mode)!");
    };
  </script>

</body>
</html>
