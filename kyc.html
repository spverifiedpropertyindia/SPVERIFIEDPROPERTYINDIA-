<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>KYC - SP Verified Property India</title>
  <link rel="stylesheet" href="css/style.css"/>
</head>
<body>

<div class="nav">
  <div class="logo">üìù KYC Verification</div>
  <div class="menu">
    <a href="index.html">Home</a>
    <a href="dashboard.html">Dashboard</a>
  </div>
</div>

<div class="container">
  <div class="box">
    <h2>Submit KYC ‚úÖ</h2>
    <p class="small">KYC submit ke baad Admin approve/reject karega.</p>

    <form id="kycForm">
      <label>Full Name</label>
      <input id="fullName" required>

      <label>Phone</label>
      <input id="phone" required>

      <label>Address</label>
      <textarea id="address" required></textarea>

      <label>ID Type</label>
      <select id="idType" required>
        <option value="Aadhaar">Aadhaar</option>
        <option value="PAN">PAN</option>
        <option value="Driving">Driving</option>
      </select>

      <label>ID Number</label>
      <input id="idNumber" required>

      <!-- ‚úÖ Upload fields (NOW COMPULSORY) -->
      <label>PAN Card Photo (Required)</label>
      <input type="file" id="panPhoto" accept="image/*" required>

      <label>Aadhaar Front Photo (Required)</label>
      <input type="file" id="aadhaarFront" accept="image/*" required>

      <label>Aadhaar Back Photo (Required)</label>
      <input type="file" id="aadhaarBack" accept="image/*" required>

      <!-- ‚úÖ WhatsApp Send Box + Button -->
      <div style="margin-top:10px;padding:10px;border:1px dashed #ccc;border-radius:12px;background:#fff7e6;">
        <p class="small" style="margin:0;">
          ‚úÖ <b>Important:</b> Photo upload compulsory hai ‚úÖ<br/>
          ‚ö†Ô∏è Storage OFF hai, isliye photos yahan save/upload nahi hongi.<br/>
          ‚úÖ Documents WhatsApp par bhejna compulsory hai.
        </p>
      </div>

      <button type="button" class="btn2" style="width:100%;margin-top:10px;"
        onclick="window.open('https://wa.me/918305070599?text=Hello%20SP%20Verified%20Property%20India%2C%20Main%20KYC%20documents%20(PAN%20%2B%20Aadhaar)%20bhej%20raha%20hu.%20Please%20verify%20my%20KYC.','_blank')">
        üì§ Send PAN + Aadhaar on WhatsApp
      </button>

      <button class="btn" style="margin-top:12px;width:100%;">Submit KYC</button>
    </form>

    <p class="small" id="msg" style="margin-top:10px;"></p>
  </div>

  <div class="footer">
    ‚úÖ WhatsApp Support:
    <a href="https://wa.me/918305070599" target="_blank"><b>8305070599</b></a>
    &nbsp; | &nbsp;
    ‚úÖ Support Email:
    <a href="mailto:spverifiedproperty@gmail.com"><b>spverifiedproperty@gmail.com</b></a>
  </div>
</div>

<script type="module">
  import { db } from "./js/firebase.js";
  import { listenUser } from "./js/auth.js";
  import { doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  const form = document.getElementById("kycForm");
  const msg = document.getElementById("msg");
  let userData = null;

  listenUser((u)=>{
    if(!u){
      alert("Login required!");
      location.href="login.html";
      return;
    }
    userData = u;
  });

  form.onsubmit = async (e)=>{
    e.preventDefault();
    if(!userData) return;

    // ‚úÖ Compulsory selection check
    const panSelected = document.getElementById("panPhoto").files.length > 0;
    const aadhaarFrontSelected = document.getElementById("aadhaarFront").files.length > 0;
    const aadhaarBackSelected = document.getElementById("aadhaarBack").files.length > 0;

    if(!panSelected || !aadhaarFrontSelected || !aadhaarBackSelected){
      alert("‚ö†Ô∏è PAN + Aadhaar Front + Aadhaar Back upload compulsory hai!");
      return;
    }

    await setDoc(doc(db, "kyc", userData.uid), {
      uid: userData.uid,
      fullName: fullName.value,
      phone: phone.value,
      address: address.value,
      idType: idType.value,
      idNumber: idNumber.value,

      // ‚úÖ only boolean info (no image upload)
      panPhotoSelected: panSelected,
      aadhaarFrontSelected: aadhaarFrontSelected,
      aadhaarBackSelected: aadhaarBackSelected,

      status: "PENDING",
      createdAt: serverTimestamp()
    });

    msg.innerHTML = "‚úÖ KYC Submitted! ‡§Ö‡§¨ PAN/Aadhaar WhatsApp ‡§™‡§∞ ‡§ú‡§∞‡•Ç‡§∞ ‡§≠‡•á‡§ú‡•á‡§Ç ‚úÖ";
    form.reset();
  }
</script>

</body>
        </html>
